<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>roger - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="style.css">

<script>window.initFuncs = [];</script>
<script src="jquery.js" defer></script>



<script>var goVersion = "go1.15";</script>
<script src="godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:6161/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:6161/pkg/">GoDoc</a></div>
<a href="godoc.7.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:6161/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package roger
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/peake100/rogerRabbit-go/roger"</code></dd>
			</dl>
			<dl>
			<dd><a href="godoc.7.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="godoc.7.html#pkg-index" class="indexLink">Index</a></dd>
			
				<dd><a href="godoc.7.html#pkg-examples" class="examplesLink">Examples</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
package roger reduces messaging boilerplate with higher-level abstractions that build on
top of the amqp package.
</p>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="godoc.7.html#AmqpDeliveryProcessor">type AmqpDeliveryProcessor</a></dd>
				
				
			
				
				<dd><a href="godoc.7.html#AmqpRouteManager">type AmqpRouteManager</a></dd>
				
				
			
				
				<dd><a href="godoc.7.html#ConsumeArgs">type ConsumeArgs</a></dd>
				
				
			
				
				<dd><a href="godoc.7.html#Consumer">type Consumer</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#NewConsumer">func NewConsumer(channel *amqp.Channel, opts *ConsumerOpts) *Consumer</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#Consumer.RegisterProcessor">func (consumer *Consumer) RegisterProcessor(processor AmqpDeliveryProcessor)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#Consumer.Run">func (consumer *Consumer) Run() error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#Consumer.StartShutdown">func (consumer *Consumer) StartShutdown()</a></dd>
				
			
				
				<dd><a href="godoc.7.html#ConsumerOpts">type ConsumerOpts</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#NewConsumerOpts">func NewConsumerOpts() *ConsumerOpts</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ConsumerOpts.WithLogger">func (opts *ConsumerOpts) WithLogger(logger zerolog.Logger) *ConsumerOpts</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ConsumerOpts.WithMaxWorkers">func (opts *ConsumerOpts) WithMaxWorkers(max int) *ConsumerOpts</a></dd>
				
			
				
				<dd><a href="godoc.7.html#ErrProducerNack">type ErrProducerNack</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ErrProducerNack.Error">func (err ErrProducerNack) Error() string</a></dd>
				
			
				
				<dd><a href="godoc.7.html#ErrProducerPublish">type ErrProducerPublish</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ErrProducerPublish.Error">func (err ErrProducerPublish) Error() string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ErrProducerPublish.Unwrap">func (err ErrProducerPublish) Unwrap() error</a></dd>
				
			
				
				<dd><a href="godoc.7.html#Producer">type Producer</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#NewProducer">func NewProducer(amqpChannel *amqp.Channel, opts *ProducerOpts) *Producer</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#Producer.Publish">func (producer *Producer) Publish(ctx context.Context, exchange string, key string, mandatory bool, immediate bool, msg amqp.Publishing) (err error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#Producer.Run">func (producer *Producer) Run() error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#Producer.StartShutdown">func (producer *Producer) StartShutdown()</a></dd>
				
			
				
				<dd><a href="godoc.7.html#ProducerOpts">type ProducerOpts</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#NewProducerOpts">func NewProducerOpts() *ProducerOpts</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ProducerOpts.WithConfirmPublish">func (opts *ProducerOpts) WithConfirmPublish(confirm bool) *ProducerOpts</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="godoc.7.html#ProducerOpts.WithInternalQueueCapacity">func (opts *ProducerOpts) WithInternalQueueCapacity(size int) *ProducerOpts</a></dd>
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		
		<div id="pkg-examples">
			<h3>Examples</h3>
			<div class="js-expandAll expandAll collapsed">(Expand All)</div>
			<dl>
			
			<dd><a class="exampleLink" href="godoc.7.html#example_NewProducer">NewProducer</a></dd>
			
			</dl>
		</div>
		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go">consumer.go</a>
			
				<a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/doc.go">doc.go</a>
			
				<a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go">producer.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
		
			
			
			<h2 id="AmqpDeliveryProcessor">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=2098:2994#L53">AmqpDeliveryProcessor</a>
				<a class="permalink" href="godoc.7.html#AmqpDeliveryProcessor">&#xb6;</a>
				
				
			</h2>
			<p>
AmqpDeliveryProcessor is an interface for handling consuming from a route.
Implementors of this interface will be registered with a consumer.
</p>

			<pre>type AmqpDeliveryProcessor interface {
    <span class="comment">// ConsumeArgs returns the args that amqp.Channel.Consume should be called with.</span>
    ConsumeArgs() *<a href="godoc.7.html#ConsumeArgs">ConsumeArgs</a>

    <span class="comment">// SetupChannel is called before the consumer is created, and is designed to let</span>
    <span class="comment">// this handler declare any exchanges or queues necessary to handle deliveries.</span>
    SetupChannel(ctx <a href="http://localhost:6161/pkg/context/">context</a>.<a href="http://localhost:6161/pkg/context/#Context">Context</a>, amqpChannel <a href="godoc.7.html#AmqpRouteManager">AmqpRouteManager</a>) <a href="http://localhost:6161/pkg/builtin/#error">error</a>

    <span class="comment">// HandleDelivery will be called once per delivery. Returning a non-nil err will</span>
    <span class="comment">// result in it being logged and the delivery being nacked. If requeue is true, the</span>
    <span class="comment">// nacked delivery will be requeued. If err is nil, requeue is ignored.</span>
    HandleDelivery(
        ctx <a href="http://localhost:6161/pkg/context/">context</a>.<a href="http://localhost:6161/pkg/context/#Context">Context</a>, delivery <a href="godoc.4.html">dataModels</a>.<a href="godoc.4.html#Delivery">Delivery</a>, logger <a href="http://localhost:6161/pkg/github.com/rs/zerolog/">zerolog</a>.<a href="http://localhost:6161/pkg/github.com/rs/zerolog/#Logger">Logger</a>,
    ) (err <a href="http://localhost:6161/pkg/builtin/#error">error</a>, requeue <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>)

    <span class="comment">// Cleanup is called at shutdown to allow the route handler to clean up any</span>
    <span class="comment">// necessary resources.</span>
    Cleanup(amqpChannel <a href="godoc.7.html#AmqpRouteManager">AmqpRouteManager</a>) <a href="http://localhost:6161/pkg/builtin/#error">error</a>
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="AmqpRouteManager">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=423:1355#L7">AmqpRouteManager</a>
				<a class="permalink" href="godoc.7.html#AmqpRouteManager">&#xb6;</a>
				
				
			</h2>
			<p>
AmqpRouteManager is an interface that only exposes the Queue and exchange methods for
a channel. These are the only methods we want SetupChannel to have access to.
</p>

			<pre>type AmqpRouteManager interface {
    QueueDeclare(
        name <a href="http://localhost:6161/pkg/builtin/#string">string</a>,
        durable <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>,
        autoDelete <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>,
        exclusive <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>,
        noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>,
        args <a href="http://localhost:6161/pkg/github.com/streadway/amqp/">streadway</a>.<a href="http://localhost:6161/pkg/github.com/streadway/amqp/#Table">Table</a>,
    ) (queue <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Queue">Queue</a>, err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
    QueueDeclarePassive(
        name <a href="http://localhost:6161/pkg/builtin/#string">string</a>, durable, autoDelete, exclusive, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>, args <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Table">Table</a>,
    ) (queue <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Queue">Queue</a>, err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
    QueueInspect(name <a href="http://localhost:6161/pkg/builtin/#string">string</a>) (queue <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Queue">Queue</a>, err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
    QueueBind(name, key, exchange <a href="http://localhost:6161/pkg/builtin/#string">string</a>, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>, args <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Table">Table</a>) <a href="http://localhost:6161/pkg/builtin/#error">error</a>
    QueueDelete(name <a href="http://localhost:6161/pkg/builtin/#string">string</a>, ifUnused, ifEmpty, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>) (count <a href="http://localhost:6161/pkg/builtin/#int">int</a>, err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)

    ExchangeDeclare(
        name, kind <a href="http://localhost:6161/pkg/builtin/#string">string</a>, durable, autoDelete, internal, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>, args <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Table">Table</a>,
    ) (err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
    ExchangeDeclarePassive(
        name, kind <a href="http://localhost:6161/pkg/builtin/#string">string</a>, durable, autoDelete, internal, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>, args <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Table">Table</a>,
    ) (err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
    ExchangeBind(
        destination, key, source <a href="http://localhost:6161/pkg/builtin/#string">string</a>, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>, args <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Table">Table</a>,
    ) (err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
    ExchangeDelete(name <a href="http://localhost:6161/pkg/builtin/#string">string</a>, ifUnused, noWait <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>) (err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="ConsumeArgs">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=1420:1948#L36">ConsumeArgs</a>
				<a class="permalink" href="godoc.7.html#ConsumeArgs">&#xb6;</a>
				
				
			</h2>
			<p>
ConsumeArgs are the args the consumer will be created with.
</p>

			<pre>type ConsumeArgs struct {
<span id="ConsumeArgs.Queue"></span>    <span class="comment">// Queue is the name of the Queue to consume from</span>
    Queue <a href="http://localhost:6161/pkg/builtin/#string">string</a>
<span id="ConsumeArgs.ConsumerName"></span>    <span class="comment">// ConsumerName identifies this consumer with the broker.</span>
    ConsumerName <a href="http://localhost:6161/pkg/builtin/#string">string</a>
<span id="ConsumeArgs.AutoAck"></span>    <span class="comment">// AutoAck is whether the broker should ack messages automatically as it sends them.</span>
    <span class="comment">// Otherwise the consumer will handle acking messages.</span>
    AutoAck <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>
<span id="ConsumeArgs.Exclusive"></span>    <span class="comment">// Exclusive is whether this consumer should be the exclusive consumer for this</span>
    <span class="comment">// Queue.</span>
    Exclusive <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>
<span id="ConsumeArgs.Args"></span>    <span class="comment">// Args are additional args to pass to the amqp.Channel.Consume() method.</span>
    Args <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Table">Table</a>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="Consumer">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=3931:4605#L102">Consumer</a>
				<a class="permalink" href="godoc.7.html#Consumer">&#xb6;</a>
				
				
			</h2>
			<p>
Consumer is a service helper for consuming messages from one or more queues.
</p>

			<pre>type Consumer struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewConsumer">func <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=10527:10600#L349">NewConsumer</a>
					<a class="permalink" href="godoc.7.html#NewConsumer">&#xb6;</a>
					
					
				</h3>
				<pre>func NewConsumer(
    channel *<a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Channel">Channel</a>, opts *<a href="godoc.7.html#ConsumerOpts">ConsumerOpts</a>,
) *<a href="godoc.7.html#Consumer">Consumer</a></pre>
				<p>
NewConsumer returns a new consumer using the passed amqp.Channel.
</p>

				
				
			

			
				
				<h3 id="Consumer.RegisterProcessor">func (*Consumer) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=4704:4784#L130">RegisterProcessor</a>
					<a class="permalink" href="godoc.7.html#Consumer.RegisterProcessor">&#xb6;</a>
					
					
				</h3>
				<pre>func (consumer *<a href="godoc.7.html#Consumer">Consumer</a>) RegisterProcessor(
    processor <a href="godoc.7.html#AmqpDeliveryProcessor">AmqpDeliveryProcessor</a>,
)</pre>
				<p>
RegisterProcessor registers a consumer handler. Will panic if called after consumer
start.
</p>

				
				
				
			
				
				<h3 id="Consumer.Run">func (*Consumer) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=9151:9188#L299">Run</a>
					<a class="permalink" href="godoc.7.html#Consumer.Run">&#xb6;</a>
					
					
				</h3>
				<pre>func (consumer *<a href="godoc.7.html#Consumer">Consumer</a>) Run() <a href="http://localhost:6161/pkg/builtin/#error">error</a></pre>
				<p>
Run the consumer. This method blocks until the consumer has completed shutdown.
</p>

				
				
				
			
				
				<h3 id="Consumer.StartShutdown">func (*Consumer) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=10383:10424#L344">StartShutdown</a>
					<a class="permalink" href="godoc.7.html#Consumer.StartShutdown">&#xb6;</a>
					
					
				</h3>
				<pre>func (consumer *<a href="godoc.7.html#Consumer">Consumer</a>) StartShutdown()</pre>
				<p>
StartShutdown beings shutdown of the Consumer. This method will return immediately,
it does not block until shutdown is complete.
</p>

				
				
				
			
		
			
			
			<h2 id="ConsumerOpts">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=3050:3202#L74">ConsumerOpts</a>
				<a class="permalink" href="godoc.7.html#ConsumerOpts">&#xb6;</a>
				
				
			</h2>
			<p>
ConsumerOpts holds options for running a consumer.
</p>

			<pre>type ConsumerOpts struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewConsumerOpts">func <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=3760:3796#L97">NewConsumerOpts</a>
					<a class="permalink" href="godoc.7.html#NewConsumerOpts">&#xb6;</a>
					
					
				</h3>
				<pre>func NewConsumerOpts() *<a href="godoc.7.html#ConsumerOpts">ConsumerOpts</a></pre>
				<p>
NewConsumerOpts returns new ConsumerOpts object with default settings.
</p>

				
				
			

			
				
				<h3 id="ConsumerOpts.WithLogger">func (*ConsumerOpts) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=3572:3645#L91">WithLogger</a>
					<a class="permalink" href="godoc.7.html#ConsumerOpts.WithLogger">&#xb6;</a>
					
					
				</h3>
				<pre>func (opts *<a href="godoc.7.html#ConsumerOpts">ConsumerOpts</a>) WithLogger(logger <a href="http://localhost:6161/pkg/github.com/rs/zerolog/">zerolog</a>.<a href="http://localhost:6161/pkg/github.com/rs/zerolog/#Logger">Logger</a>) *<a href="godoc.7.html#ConsumerOpts">ConsumerOpts</a></pre>
				<p>
WithLogger sets a zerolog.Logger to use for logging. Defaults to a fresh logger with
the global settings applied.
</p>

				
				
				
			
				
				<h3 id="ConsumerOpts.WithMaxWorkers">func (*ConsumerOpts) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/consumer.go?s=3347:3410#L84">WithMaxWorkers</a>
					<a class="permalink" href="godoc.7.html#ConsumerOpts.WithMaxWorkers">&#xb6;</a>
					
					
				</h3>
				<pre>func (opts *<a href="godoc.7.html#ConsumerOpts">ConsumerOpts</a>) WithMaxWorkers(max <a href="http://localhost:6161/pkg/builtin/#int">int</a>) *<a href="godoc.7.html#ConsumerOpts">ConsumerOpts</a></pre>
				<p>
WithMaxWorkers sets the maximum number of workers that can be running at the same
time. If 0 or less, no limit will be used. Default: 0.
</p>

				
				
				
			
		
			
			
			<h2 id="ErrProducerNack">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=758:1007#L21">ErrProducerNack</a>
				<a class="permalink" href="godoc.7.html#ErrProducerNack">&#xb6;</a>
				
				
			</h2>
			<p>
ErrProducerNack is the error returned when trying to publish through the broker
channel results in an error.
</p>

			<pre>type ErrProducerNack struct {
<span id="ErrProducerNack.Orphan"></span>    <span class="comment">// Orphan is whether this nack was a result of being an orphaned message. Orphaned</span>
    <span class="comment">// messages MAY have been successfully published, but there is no way to know for</span>
    <span class="comment">// sure that the broker received it.</span>
    Orphan <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>
}
</pre>

			

			

			
			
			

			

			
				
				<h3 id="ErrProducerNack.Error">func (ErrProducerNack) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=1045:1086#L29">Error</a>
					<a class="permalink" href="godoc.7.html#ErrProducerNack.Error">&#xb6;</a>
					
					
				</h3>
				<pre>func (err <a href="godoc.7.html#ErrProducerNack">ErrProducerNack</a>) Error() <a href="http://localhost:6161/pkg/builtin/#string">string</a></pre>
				<p>
Error implements builtins.error.
</p>

				
				
				
			
		
			
			
			<h2 id="ErrProducerPublish">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=268:317#L3">ErrProducerPublish</a>
				<a class="permalink" href="godoc.7.html#ErrProducerPublish">&#xb6;</a>
				
				
			</h2>
			<p>
ErrProducerPublish is the error returned when trying to publish through the broker
channel results in an error.
</p>

			<pre>type ErrProducerPublish struct {
<span id="ErrProducerPublish.AmqpErr"></span>    AmqpErr <a href="http://localhost:6161/pkg/builtin/#error">error</a>
}
</pre>

			

			

			
			
			

			

			
				
				<h3 id="ErrProducerPublish.Error">func (ErrProducerPublish) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=499:543#L13">Error</a>
					<a class="permalink" href="godoc.7.html#ErrProducerPublish.Error">&#xb6;</a>
					
					
				</h3>
				<pre>func (err <a href="godoc.7.html#ErrProducerPublish">ErrProducerPublish</a>) Error() <a href="http://localhost:6161/pkg/builtin/#string">string</a></pre>
				<p>
Error implements builtins.error.
</p>

				
				
				
			
				
				<h3 id="ErrProducerPublish.Unwrap">func (ErrProducerPublish) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=393:437#L8">Unwrap</a>
					<a class="permalink" href="godoc.7.html#ErrProducerPublish.Unwrap">&#xb6;</a>
					
					
				</h3>
				<pre>func (err <a href="godoc.7.html#ErrProducerPublish">ErrProducerPublish</a>) Unwrap() <a href="http://localhost:6161/pkg/builtin/#error">error</a></pre>
				<p>
Unwrap implements xerrors.Wrapper and returns the original Amqp error.
</p>

				
				
				
			
		
			
			
			<h2 id="Producer">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=3076:3891#L93">Producer</a>
				<a class="permalink" href="godoc.7.html#Producer">&#xb6;</a>
				
				
			</h2>
			<p>
Producer is a wrapper for an amqp channel that handles the boilerplate of confirming
publishings, retrying nacked messages, and other useful quality of life features.
</p>

			<pre>type Producer struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewProducer">func <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=12295:12368#L376">NewProducer</a>
					<a class="permalink" href="godoc.7.html#NewProducer">&#xb6;</a>
					
					
				</h3>
				<pre>func NewProducer(amqpChannel *<a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Channel">Channel</a>, opts *<a href="godoc.7.html#ProducerOpts">ProducerOpts</a>) *<a href="godoc.7.html#Producer">Producer</a></pre>
				<p>
NewProducer creates a new producer using the given amqp.Channel and opts.
</p>
<p>
amqpChannel should be a fresh channel that has been configured with the correct
queues for the producer. It should have no messages published through it before it
is passed to this method.
</p>
<p>
Once the channel is passed to the producer, the producer should be considered to
own it. No additional operations should be done through amqpChannel once it is
passed to this method. The channel will be closed upon producer shutdown. A single
channel should NOT be passed to multiple producers.
</p>
<p>
If opts.confirmPublish is set to true, the channel will be put into confirm mode
by the producer. There is no need to do so before passing it to this method.
</p>
<p>
If opts is nil, default options will be used.
</p>

				<div id="example_NewProducer" class="toggle">
	<div class="collapsed">
		<p class="exampleHeading toggleButton">▹ <span class="text">Example</span></p>
	</div>
	<div class="expanded">
		<p class="exampleHeading toggleButton">▾ <span class="text">Example</span></p>
		
		
		
			<p>Code:</p>
			<pre class="code"><span class="comment">// Get a new connection to our test broker.</span>
connection, err := amqp.DialCtx(context.Background(), amqpTest.TestDialAddress)
if err != nil {
    panic(err)
}
defer connection.Close()

<span class="comment">// Get a new channel from our robust connection for publishing. The channel is</span>
<span class="comment">// created with our default middleware.</span>
channel, err := connection.Channel()
if err != nil {
    panic(err)
}

<span class="comment">// Declare a queue to produce to</span>
queue, err := channel.QueueDeclare(
    &#34;example_confirmation_producer&#34;, <span class="comment">// name</span>
    false,                           <span class="comment">// durable</span>
    true,                            <span class="comment">// autoDelete</span>
    false,                           <span class="comment">// exclusive</span>
    false,                           <span class="comment">// noWait</span>
    nil,                             <span class="comment">// args</span>
)

<span class="comment">// Create a new producer using our channel. Passing nil to opts will result in</span>
<span class="comment">// default opts being used. By default, a Producer will put the passed channel in</span>
<span class="comment">// confirmation mode, and each time publish is called, will block until a</span>
<span class="comment">// confirmation from the server has been received.</span>
producer := roger.NewProducer(channel, nil)
producerComplete := make(chan struct{})

<span class="comment">// Run the producer in it&#39;s own goroutine.</span>
go func() {
    <span class="comment">// Signal this routine has exited on exit.</span>
    defer close(producerComplete)

    err = producer.Run()
    if err != nil {
        panic(err)
    }
}()

messagesPublished := new(sync.WaitGroup)
for i := 0; i &lt; 10; i++ {

    messagesPublished.Add(1)

    <span class="comment">// Publish each message in it&#39;s own goroutine.</span>
    go func() {
        <span class="comment">// Release our WaitGroup on exit.</span>
        defer messagesPublished.Done()

        ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
        defer cancel()

        <span class="comment">// Publish a message, this method will block until we get a publication</span>
        <span class="comment">// confirmation from the broker OR ctx expires.</span>
        err = producer.Publish(
            ctx,
            &#34;&#34;,
            queue.Name,
            false,
            false,
            amqp.Publishing{
                Body: []byte(&#34;test message&#34;),
            },
        )

        fmt.Println(&#34;Message Published!&#34;)

        if err != nil {
            panic(err)
        }
    }()
}

<span class="comment">// Wait for all our messages to be published</span>
messagesPublished.Wait()

<span class="comment">// Start the shutdown of the producer</span>
producer.StartShutdown()

<span class="comment">// Wait for the producer to exit.</span>
&lt;-producerComplete

<span class="comment">// exit.</span>

<span class="comment"></pre>
			
			<p>Output:</p>
			<pre class="output">Message Published!
Message Published!
Message Published!
Message Published!
Message Published!
Message Published!
Message Published!
Message Published!
Message Published!
Message Published!
</pre>
			
		
	</div>
</div>

				
			

			
				
				<h3 id="Producer.Publish">func (*Producer) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=6878:7035#L204">Publish</a>
					<a class="permalink" href="godoc.7.html#Producer.Publish">&#xb6;</a>
					
					
				</h3>
				<pre>func (producer *<a href="godoc.7.html#Producer">Producer</a>) Publish(
    ctx <a href="http://localhost:6161/pkg/context/">context</a>.<a href="http://localhost:6161/pkg/context/#Context">Context</a>,
    exchange <a href="http://localhost:6161/pkg/builtin/#string">string</a>,
    key <a href="http://localhost:6161/pkg/builtin/#string">string</a>,
    mandatory <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>,
    immediate <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>,
    msg <a href="godoc.8.html">amqp</a>.<a href="godoc.8.html#Publishing">Publishing</a>,
) (err <a href="http://localhost:6161/pkg/builtin/#error">error</a>)</pre>
				<p>
Publish a message. This method is goroutine safe, even when confirming publications
with the broker. When confirming messages with a broker, this method will block until
the broker confirms the message publication or ctx is cancelled.
</p>
<p>
Cancelling the context will cause this method to return, but have no other effect
if the message has already been sent to thr broker and we are waiting for a response.
</p>

				
				
				
			
				
				<h3 id="Producer.Run">func (*Producer) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=8702:8739#L272">Run</a>
					<a class="permalink" href="godoc.7.html#Producer.Run">&#xb6;</a>
					
					
				</h3>
				<pre>func (producer *<a href="godoc.7.html#Producer">Producer</a>) Run() <a href="http://localhost:6161/pkg/builtin/#error">error</a></pre>
				<p>
Run the producer, this method blocks until the producer has been shut down.
</p>

				
				
				
			
				
				<h3 id="Producer.StartShutdown">func (*Producer) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=11188:11229#L349">StartShutdown</a>
					<a class="permalink" href="godoc.7.html#Producer.StartShutdown">&#xb6;</a>
					
					
				</h3>
				<pre>func (producer *<a href="godoc.7.html#Producer">Producer</a>) StartShutdown()</pre>
				<p>
StartShutdown begins the shutdown of the producer. This method may exit before
remaining work is completed.
</p>

				
				
				
			
		
			
			
			<h2 id="ProducerOpts">type <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=1932:2117#L62">ProducerOpts</a>
				<a class="permalink" href="godoc.7.html#ProducerOpts">&#xb6;</a>
				
				
			</h2>
			<p>
ProducerOpts holds options for Producer.
</p>

			<pre>type ProducerOpts struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewProducerOpts">func <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=11359:11395#L355">NewProducerOpts</a>
					<a class="permalink" href="godoc.7.html#NewProducerOpts">&#xb6;</a>
					
					
				</h3>
				<pre>func NewProducerOpts() *<a href="godoc.7.html#ProducerOpts">ProducerOpts</a></pre>
				<p>
NewProducerOpts returns a new ProducerOpts with default options.
</p>

				
				
			

			
				
				<h3 id="ProducerOpts.WithConfirmPublish">func (*ProducerOpts) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=2371:2443#L74">WithConfirmPublish</a>
					<a class="permalink" href="godoc.7.html#ProducerOpts.WithConfirmPublish">&#xb6;</a>
					
					
				</h3>
				<pre>func (opts *<a href="godoc.7.html#ProducerOpts">ProducerOpts</a>) WithConfirmPublish(confirm <a href="http://localhost:6161/pkg/builtin/#bool">bool</a>) *<a href="godoc.7.html#ProducerOpts">ProducerOpts</a></pre>
				<p>
WithConfirmPublish sets whether to confirm publications with the broker before
returning on a &#34;Publish&#34; call When true, all called to Producer.Publish() will block
until a publish confirmation is received from the broker.
</p>
<p>
Default: true.
</p>

				
				
				
			
				
				<h3 id="ProducerOpts.WithInternalQueueCapacity">func (*ProducerOpts) <a href="http://localhost:6161/src/github.com/peake100/rogerRabbit-go/roger/producer.go?s=2774:2849#L86">WithInternalQueueCapacity</a>
					<a class="permalink" href="godoc.7.html#ProducerOpts.WithInternalQueueCapacity">&#xb6;</a>
					
					
				</h3>
				<pre>func (opts *<a href="godoc.7.html#ProducerOpts">ProducerOpts</a>) WithInternalQueueCapacity(size <a href="http://localhost:6161/pkg/builtin/#int">int</a>) *<a href="godoc.7.html#ProducerOpts">ProducerOpts</a></pre>
				<p>
WithInternalQueueCapacity sets the internal queue size.
</p>
<p>
Internally, the producer stores incoming publication requests and published requests
waiting for a broker acknowledgement in go channels. This options sets the size
for those internal queues.
</p>
<p>
Default: 64
</p>

				
				
				
			
		
	

	







<div id="footer">
Build version go1.15.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:6161/LICENSE">BSD license</a>.<br>
<a href="http://localhost:6161/doc/tos.html">Terms of Service</a> |
<a href="http://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
